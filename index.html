<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sentellect - Mental Wellness Survey</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== Base Styles ===== */
    :root {
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --secondary: #f59e0b;
      --text: #1e293b;
      --bg: #f8fafc;
      --white: #ffffff;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      --success: #10b981;
      --error: #e74c3c;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: var(--text); line-height: 1.6; }
    .container { width: 100%; max-width: 1000px; margin: 0 auto; padding: 0 20px; }
    section { padding: 60px 0; }
    .section-title { text-align: center; margin-bottom: 40px; }
    .section-title h2 { font-size: 2.2rem; color: var(--primary); }
    .btn { display: inline-block; padding: 12px 28px; border-radius: 50px; font-weight: 600; transition: all 0.3s ease; text-align: center; cursor: pointer; border: none; }
    .btn-primary { background-color: var(--primary); color: var(--white); box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3); }
    .btn-primary:hover { background-color: var(--primary-light); transform: translateY(-2px); }
    .card { background-color: var(--white); border-radius: 16px; padding: 25px; margin: 20px 0; box-shadow: var(--card-shadow); }
    .interactive-survey { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 30px; border-radius: 10px; margin: 30px 0; border: 1px solid #d1d9e6; }
    .survey-question { background: white; padding: 15px; margin: 20px 0; border-radius: 8px; border-left: 4px solid var(--secondary); }
    .survey-question p { font-weight: 500; margin-bottom: 15px; }
    .quiz-options { display: flex; flex-direction: column; gap: 10px; }
    .quiz-option-label { cursor: pointer; padding: 8px 10px; border-radius: 5px; transition: background-color 0.2s; }
    .quiz-option-label:hover { background-color: #f0f4f8; }
    .demographics { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; }
    .demographics label { display: block; margin-top: 15px; font-weight: 600; color: var(--primary); }
    .demographics input, .demographics select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    header, footer { background-color: var(--primary); color: var(--white); padding: 20px 0; text-align: center; }
  </style>
</head>
<body>

  <header>
    <div class="container"><h1>Mental Wellness Survey</h1></div>
  </header>
  
  <section id="comprehensive-quiz" class="section">
    <div class="section-title">
      <h2>Depression and Anxiety Scale</h2>
      <p>Please select the option that best describes you over the **last week**.</p>
    </div>

    <div class="container">
        <div class="card">
            <div class="interactive-survey">
                <form id="mental-wellness-form">
                    
                    <h3><i class="fas fa-user-circle"></i> About You</h3>
                    <div class="demographics">
                        <label for="age">Age:</label>
                        <input type="number" id="age" name="age" required min="1" max="120">
                        
                        <label for="gender">Gender:</label>
                        <select id="gender" name="gender" required>
                            <option value="" disabled selected>Select...</option>
                            <option value="1">Male</option>
                            <option value="2">Female</option>
                            <option value="3">Other</option>
                            <option value="0">Prefer not to say</option>
                        </select>
                    </div>

                    <h3><i class="fas fa-chart-line"></i> Questions</h3>
                    
                    <div id="questions-container">
                        </div>

                    <script>
                        const questions = [
                            {id: 'Q3A', text: "1. I couldn't seem to experience any positive feeling at all."},
                            {id: 'Q5A', text: "2. I found it difficult to work up the initiative to do things."},
                            {id: 'Q10A', text: "3. I felt that I had nothing to look forward to."},
                            {id: 'Q13A', text: "4. I felt sad and depressed."},
                            {id: 'Q16A', text: "5. I felt that I had lost interest in just about everything."},
                            {id: 'Q17A', text: "6. I felt I wasn't worth much as a person."},
                            {id: 'Q21A', text: "7. I felt that life was meaningless."},
                            {id: 'Q24A', text: "8. I couldn't seem to get any enjoyment out of the things I did."},
                            {id: 'Q26A', text: "9. I felt down-hearted and blue."},
                            {id: 'Q31A', text: "10. I was unable to become enthusiastic about anything."},
                            {id: 'Q34A', text: "11. I felt I was pretty worthless."},
                            {id: 'Q37A', text: "12. I could see nothing in the future to be hopeful about."},
                            {id: 'Q38A', text: "13. I felt that life wasn't worthwhile."},
                            {id: 'Q42A', text: "14. I found it difficult to work up the initiative to do things."},
                            {id: 'Q2A', text: "15. I was aware of dryness of my mouth."},
                            {id: 'Q4A', text: "16. I experienced breathing difficulty."},
                            {id: 'Q7A', text: "17. I had a feeling of shakiness (e.g., legs going to give way)."},
                            {id: 'Q9A', text: "18. I found myself in situations that made me so anxious I was most relieved when they ended."},
                            {id: 'Q15A', text: "19. I had a feeling of faintness."},
                            {id: 'Q19A', text: "20. I perspired noticeably (e.g., hands sweaty)."},
                            {id: 'Q20A', text: "21. I felt scared without any good reason."},
                            {id: 'Q23A', text: "22. I had difficulty in swallowing."},
                            {id: 'Q25A', text: "23. I was aware of the action of my heart in the absence of physical exertion."},
                            {id: 'Q28A', text: "24. I felt I was close to panic."},
                            {id: 'Q30A', text: "25. I feared that I would be 'thrown' by some trivial but unfamiliar task."},
                            {id: 'Q36A', text: "26. I felt terrified."},
                            {id: 'Q40A', text: "27. I was worried about situations in which I might panic and make a fool of myself."},
                            {id: 'Q41A', text: "28. I experienced trembling (e.g., in the hands)."}
                        ];
                        
                        const container = document.getElementById('questions-container');
                        questions.forEach(q => {
                            const div = document.createElement('div');
                            div.className = 'survey-question';
                            div.innerHTML = `
                                <p><strong>${q.text}</strong></p>
                                <div class="quiz-options">
                                    <label class="quiz-option-label"><input type="radio" name="${q.id}" value="0" required> 0 - Never</label>
                                    <label class="quiz-option-label"><input type="radio" name="${q.id}" value="1"> 1 - Sometimes</label>
                                    <label class="quiz-option-label"><input type="radio" name="${q.id}" value="2"> 2 - Often</label>
                                    <label class="quiz-option-label"><input type="radio" name="${q.id}" value="3"> 3 - Almost Always</label>
                                </div>
                            `;
                            container.appendChild(div);
                        });
                    </script>

                    <div style="text-align: center; margin-top: 40px;">
                        <button type="submit" class="btn btn-primary">Submit Survey</button>
                    </div>

                </form>
                
                <div id="results-area" style="margin-top: 30px; text-align: center; font-size: 1.2rem; font-weight: bold;"></div>
            </div>
        </div>
    </div>
  </section>

  <footer>
    <div class="container"><p>Â© 2024 Sentellect.</p></div>
  </footer>

  <script>
    // THIS IS THE ONLY SCRIPT THAT HANDLES SUBMISSION
    document.getElementById('mental-wellness-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const resultsArea = document.getElementById('results-area');
        resultsArea.innerHTML = '<p style="color: var(--primary);">Analyzing...</p>';

        // 1. Get Demographics
        const age = document.getElementById('age').value;
        const gender = document.getElementById('gender').value;

        // 2. Get Answers in specific order
        const questionOrder = [
            'Q3A', 'Q5A', 'Q10A', 'Q13A', 'Q16A', 'Q17A', 'Q21A', 'Q24A',
            'Q26A', 'Q31A', 'Q34A', 'Q37A', 'Q38A', 'Q42A', 
            'Q2A', 'Q4A', 'Q7A', 'Q9A', 'Q15A', 'Q19A', 'Q20A', 'Q23A',
            'Q25A', 'Q28A', 'Q30A', 'Q36A', 'Q40A', 'Q41A'
        ];
        
        const answers = [];
        let allAnswered = true;
        
        questionOrder.forEach(name => {
            const selected = document.querySelector(`input[name="${name}"]:checked`);
            if (selected) {
                answers.push(parseInt(selected.value));
            } else {
                allAnswered = false;
            }
        });

        if (!allAnswered || !age || !gender) {
            alert('Please answer all questions.');
            return;
        }

        // --- HERE IS THE FIX ---
        // We combine Age (1) + Gender (1) + Answers (28) = 30 Features
       const finalFeatures = [...answers, parseInt(age), parseInt(gender)];

        
        console.log("Sending " + finalFeatures.length + " features to backend."); // Should say 30

        const payload = { "features": finalFeatures };

        fetch('http://127.0.0.1:5000/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            console.log("Response:", data);
            if (data.error) {
                resultsArea.innerHTML = `<p style="color: var(--error);">Error: ${data.error}</p>`;
            } else {
                resultsArea.innerHTML = `
                    <div style="padding: 20px; background-color: #dbeafe; border-radius: 8px; color: #1e40af;">
                        <strong>Prediction Result: ${data.prediction}</strong>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            resultsArea.innerHTML = `<p style="color: var(--error);">Connection Error. Check Flask console.</p>`;
        });
    });
  </script>
</body>
</html>